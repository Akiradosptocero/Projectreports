<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <template id="project_reports_doc">
        	<t t-call="web.html_container">

			<!-- <div class="page"> -->
		
				<!-- Mostrar tabla con las tareas del proyecto filtrodo por el mes correspondiente -->
				<t t-call="projectreports.portada_del_informe"/>

				<!-- Mostrar tabla con las tareas del proyecto filtrodo por el mes correspondiente -->
				<div style="page-break-before: always;">
					<t t-call="projectreports.mostrar_tareas"/>
				</div>

				<!-- Mostrar las imagenes del Google analytics -->
				<div style="page-break-before: always;">
					<t t-call="projectreports.mostrar_capturas"/>
				</div>

				<!-- Mostrar el pie de página -->
				<t t-call="projectreports.footer_del_informe"/>

			<!-- </div> -->
	        </t>

        </template>


		<!-- To Do: poner la foto estatica en un directorio del modulo -->		
		<template id="footer_del_informe">
        	<style>

				<!-- #img-footer
				{
					margin: 10px auto 20px;
					text-align: center;
					display: block;
					border: 1px solid red; 
				} -->


        	</style>


			<div style="position: static; margin-bottom: 200px; border: 1px solid blue;" class="footer">
			<!-- <img style="border: 1px solid red; margin: 10px auto 20px; text-align: center; display: block;" width="200" height="50" t-attf-src="{{'/web/content?model=projectreports.imagenreport&amp;field=picture&amp;id=1'}}"/> -->
						
				<t t-foreach="i.imagenes" t-as="img">
					<t t-if="img_first"> 
						<img style="position: relative; border: 1px solid red; margin: 10px auto 20px; text-align: center; display: block;" width="100" t-attf-src="data:image/*;base64,{{img.picture}}"/>
					</t>	
				</t>

				<p style="position: relative; margin-bottom: 20px; border: 1px solid green; font-family: perpeta; font-style: bold; font-size: 10x;  width: 90%;  text-align: center">Elaborado por Binhex.</p>
			</div>
		</template>


		<!-- To Do: diseñar la portada
					- poner foto de fondo 
					- nombre de empres
					- mes y año del informe
					- imagen logo empresa
					 -->
		<template id="portada_del_informe">
			<img style="border: 1px solid red; margin: 10px auto 20px; text-align: center; display: block;" width="200" height="50" t-attf-src="{{'/web/content?model=projectreports.imagenreport&amp;field=picture&amp;id=1'}}"/>
			<img style="margin: 10px auto 20px;text-align: center;display: block;" width="200" height="50" t-att-src="'data:image/png;base64, /usr/lib/python3/dist-packages/odoo/addons/projectreports/static/src/img/logo.png'"/>

			<h1><span t-field="i.name"/></h1>
			<h1>Informe</h1> <!-- To Do: añadir el mes y año del informe  -->
				
			<img src="'/projectreports/static/src/img/logo.png'"/>
		</template>


		<!-- To do: diseñar la tabla
					- formatear las horas, quitar decimal
					- poner colores
					 -->
		<template id="mostrar_tareas">
        	<style>

				table#tareas 
				{
					position: relative;
   					width: 100%;
   					border: 1px solid #000;
					border-collapse: collapse;
				}

        		td 
				{
					position: relative;
				    text-align: center; 
				    vertical-align: middle;
					border: 1px solid #000;
				}

				tr#tareas:nth-child(3n+1) 
				{
					background-color: whitesmoke;
				}
				tr#tareas:nth-child(3n+2)
				{
					background-color: #dddddd;
				}

				span#tareas:
				{
					text-align: left;
					text-transform: capitalize;
				}

        	</style>

			<table id="tareas">
				<tr id="tareas">
					<td><h2>TAREAS REALIZADAS</h2></td>
					<td><h2>HORAS</h2></td>
				</tr>
				<t t-set="suma" t-value="0" />
				<t t-foreach="i.task_ids" t-as="tarea">

					<t t-if="tarea.date_end">
						<t t-if="str(tarea.date_end).split('-')[1] == str(i.month_tdisp)">
							<tr id="tareas">
								<td>
									<h3><span t-field="tarea.name"/></h3>
									<t t-if="tarea.timesheet_ids">
										<t t-foreach="tarea.timesheet_ids" t-as="act">
											<t t-if="act.name">
												<span style="border: 1px solid red; text-align: left; text-transform: capitalize;" id="tareas" t-field="act.name"/>
												<br/>
											</t>
										</t>
									</t>
									<br/>
								</td>
									
								<td><span t-esc="tarea.effective_hours"/></td>
								<t t-set="suma" t-value="tarea.effective_hours + suma" />
							</tr>
						</t>
					</t>
				</t>
							
				<tr id="tareas">
					<td><h2>TOTAL HORAS</h2></td>
					<td><h2><span t-esc="suma"/></h2></td>
				</tr>
			</table>
		</template>


		<!-- To do: tamaño de las fotos y pie de foto
					- cambiar name por descripcion de la foto
					 -->
		<template id="mostrar_capturas">
			<style>

				table#tcapturas 
				{
   					width: 100%;
   					border: 1px hidden #000;
				}

        		td#tcapturas 
				{
				    text-align: center; 
				    vertical-align: middle;
					border: 1px solid #000;
				}

				table, tr, td, td {
					valign: top;
					position: relative;
				}

				<!-- To Do: fijar el footer para poder poner un tamaño de imagen mas grande
							Cuando se amplia se desplaza y desaparece 
							 -->
				#img-capturas 
				{
					margin: 10px auto 20px;
					text-align: center;
					display: block;
					
				}

        	</style>
			
			
				<h2>Capturas de pantalla</h2>
					<t t-foreach="i.imagenes" t-as="img">
						<table id="tcapturas">
							<tr id="tcapturas" >
								<td id="tcapturas">
									<img id="img-capturas" width="200" t-attf-src="data:image/*;base64,{{img.picture}}"/>
								</td>
							</tr>
							<tr id="tcapturas">
								<td id="tcapturas">
									<span t-field="img.name"/>
								</td>
							</tr>
						</table>
					</t>
		</template>


        <template id="project_reports">
				<t t-foreach="docs" t-as="i">
					<t t-call="projectreports.project_reports_doc"/>
				</t>
        </template>
    </data>
</odoo>